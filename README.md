imapfilter
==========

### 心得
写这个程序的初衷在于练习使用 python 的较为高级的语法特性，例如 class，继承，eval，\*args，**kwargs，generators.

主要用于个人邮件的整理。虽然 google 支持强大的filter 规则，毕竟不支持正则表达式。

如果你用过 spam assassin，可能一言就看穿了，本程序是个迷你的、拙劣的 miniature of spam assassin。虽然如此，自己用的话，这款程序还挺合适。

### 正则
* 程序、配置，均采用 python 风格的正则表达式。例如，可以使用 `(?i)` 设置正则为忽略大小写模式, 以及:
    *  i, Ignore Case
    *  L, Locale dependent (较不常用)
    *  m, multi-line (即^、$可匹配内部行首行尾)
    *  s, 点号通配任意字符（包括换行符）
    *  u, unicode dependent
    *  x, 注释空白模式，（忽略正则中的空白和注释）
        * comment: (?# … )
        * 所有空白字符（包括换行）视为不存在。正则中如果需要匹配空白字符，需要自行指定，例如 `\s`。
* 支持 look around. 注意 python regex 的 look behind 只支持定长字串。
* 支持命名和分组。为节省内存，使用分组时最好使用非捕获模式 `(?: …|… )`.


###规则分为两类：

* 匹配
    * header 任意邮件头，正则匹配。所匹配的目标为utf-8编码的明文字串。

    * eval 任意函数，可以在 'msg.py' 里定义，内部通过 `eval(msg.EXPR)` 的方式进行求值。返回值应该是 boolean type 的。
    * meta 组合规则，可以包含其他 header rule and/or meta rule. 可以使用 and, or, not 以及对应的 &&, ||, ! 符号，来连接各子规则。使用 or 时，可以使用括号以便提升部分组合规则的运算优先级。
    * meta 规则的括号 是算术语法而不是正则语法，因此不适用 (?:…) 这种格式。
* 动作
    * 对于符合规则的邮件，需要采取的动作。包括
    * move
    * copy
    * delete
    * fwd （Todo）
    * 动作的顺序


### 规则名称
* 规则命名：`^[a-zA-Z_]+[a-zA-Z]\w+$` ，即，
    * 由3位及以上的字符组成，第一位可以是大小写字母或下划线，但不能是数字
    * 必须包含一位以上字母。

¯### TODO
* 程序初始化时，遍历所有 filter 的 目标文件夹，如果不存在则创建之；如果不能创建成功，则报错并置为默认邮箱。
* 多线程支持。
* 规则库平滑更新。
